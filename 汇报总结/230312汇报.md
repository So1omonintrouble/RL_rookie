# 230312 æ±‡æŠ¥

## æ€»ç»“

**é—®é¢˜**ï¼šè®­ç»ƒå¾ˆæ…¢çš„é—®é¢˜ä»ç„¶æ²¡æœ‰è§£å†³

**æ–°æ–¹æ³•**ï¼šå…ˆæ‰¾ä¸€ä¸ªé™æ€æœ€ä¼˜çš„åŠ¨ä½œå€¼ï¼Œç„¶åå¼•å…¥å¼ºåŒ–å­¦ä¹ Agentåœ¨æ­¤åŠ¨ä½œå€¼åŸºç¡€ä¸Šè¿›è¡Œé™„åŠ æ§åˆ¶

---

**æ–°å‘ç°**ï¼šé‡‡æ ·æ—¶é—´å¯èƒ½å¯¹å¼ºåŒ–å­¦ä¹ è®­ç»ƒæœ‰è¾ƒå¤§çš„å½±å“

## 3.9ä¹‹å‰

### é—®é¢˜

ç»è¿‡å°è¯•ï¼ŒTD3ï¼ŒDDPGï¼ŒDQNç®—æ³•è¿™ç§ç¡®å®šæ€§ç­–ç•¥å¼ºåŒ–å­¦ä¹ ç®—æ³•å‡ä¼šå‡ºç°è®­ç»ƒå¾ˆæ…¢çš„æƒ…å†µï¼Œä¸”æ·»åŠ å»¶è¿Ÿä¿¡å·æ²¡æœ‰ä½œç”¨

### æ–°æ–¹æ³•

**æƒ³æ³•ï¼š** ç”±äºéçº¿æ€§æ§åˆ¶å™¨ä¹‹äºçº¿æ€§æ§åˆ¶å™¨çš„ä¼˜åŠ¿ï¼Œæ’å®šçš„æ§åˆ¶å‚æ•°çš„æ€§èƒ½ä¸Šé™æ¯”ä¸ä¸Šå˜åŒ–çš„æ§åˆ¶å‚æ•°

**æ“ä½œï¼š** **è°ƒå‡ºä¸€ä¸ªæ¯”è¾ƒå¥½çš„é™æ€k**ä¹‹åï¼Œå†è®¾è®¡ä¸€ä¸ªå¼ºåŒ–å­¦ä¹ Agentï¼Œ**è¿™ä¸ªAgentæ˜¯kå€¼çš„é™„åŠ ä¿¡å·**ã€‚

> å¾®è°ƒçš„æ–¹å¼ä¸€å¼€å§‹å¯ä»¥è®¾ä¸ºç¦»æ•£åŠ¨ä½œï¼Œä½¿ç”¨DQNæˆ–PPOç®—æ³•å°±å¯ä»¥å®ç°ï¼Œåˆšå¼€å§‹åŠ¨ä½œå€¼è®¾å®šä¸º+0.001ï¼Œ0ï¼Œ-0.001æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæœ‰æ•ˆæœï¼Œåˆ™å¯ä»¥æŠŠç¦»æ•£åŠ¨ä½œå€¼è®¾ç½®æ›´å¤šä¸€ç‚¹ï¼Œå¦‚æœæ²¡æ•ˆæœï¼Œå°±ç¼©å°è¿™ä¸ªèŒƒå›´ç›´åˆ°è¿™ä¸ªèŒƒå›´å­¦å‡ºæ›´å¥½çš„å¥–åŠ±

**å…·ä½“ï¼š**

é’ˆå¯¹è°ƒå‡ºè¾ƒå¥½çš„**é™æ€kå€¼**ï¼Œé™¤äº†äººå·¥æ‰‹è°ƒï¼Œè¿˜å¯ä»¥å€ŸåŠ©å¼ºåŒ–å­¦ä¹ ç®—æ³•è¿›è¡Œï¼Œä»matlabçš„å¼ºåŒ–å­¦ä¹ è°ƒPIå‚æ•°çš„ç¤ºä¾‹ä¸­å­¦çš„ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š

> ä»æ•´ä½“æ¥çœ‹ï¼Œæ˜¯ç”¨å¼ºåŒ–å­¦ä¹ Agentæ›¿ä»£äº†PIæ§åˆ¶å™¨ï¼Œä½†è®­ç»ƒçš„ç»“æœåˆèƒ½æ ¹æ®ç¥ç»ç½‘ç»œç»“æ„å¾—åˆ°$k_P$,$k_I$çš„å…·ä½“å‚æ•°ï¼Œ
>
> ç»†èŠ‚åœ¨äºï¼Œå¦å¤–è®¾è®¡äº†ä¸€ä¸ªPIç¥ç»ç½‘ç»œå±‚ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œpredicté¢„æµ‹æ—¶æ‰€æœ‰æƒé‡éƒ½å–ç»å¯¹å€¼
>
> ![image-20230310214228927](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230310214228927.png)
>
> ![image-20230310214255932](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230310214255932.png)

> å¦‚æœæ”¾åˆ°ç›®å‰æ­£åœ¨åšçš„æŒ¯è¡æŠ‘åˆ¶ä¸­ï¼Œç”±äºç›®å‰PSSåªè€ƒè™‘kå€¼ï¼Œå› æ­¤è®¾è®¡ä¸€ä¸ªPSSç¥ç»ç½‘ç»œå±‚ï¼Œå…¶è¾“å…¥æ•°é‡ä¸º1ï¼Œè¾“å‡ºæ•°é‡ä¸º1ï¼Œå¯å­¦å‚æ•°æ•°é‡ä¸º1ï¼Œå³kå€¼ã€‚
>
> ![image-20230310214320669](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230310214320669.png)
>
> ![image-20230310214332479](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230310214332479.png)



### æ–°æ–¹æ³•ç»“æœ

å¯ä»¥è¾¾åˆ°æ‰‹è°ƒçš„æœ€å¥½çš„kå€¼é™„è¿‘ï¼Œä½†ä¸ç¨³å®š

![image-20230308185019395](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230308185019395-16784563121141.png)

åˆæ­¥åˆ¤æ–­æ˜¯å› ä¸ºcriticç¥ç»ç½‘ç»œçš„é—®é¢˜ï¼Œåé¢ä¼šå°è¯•ä»¥æ­¤ä¸ºç›®æ ‡æ¥è°ƒè¯•

#### å°è¯•å¯¹ä¸æ”¶æ•›è¿›è¡Œæ¨å¯¼ï¼ˆæœªæˆåŠŸï¼‰

TD3çš„actorç½‘ç»œåªæœ‰ä¸€ä¸ªå¯å­¦ä¹ å‚æ•°ï¼Œä¹Ÿå°±æ˜¯kå€¼ï¼Œåˆå§‹è®¾å®šæ¯”è¾ƒå°ï¼Œéšç€è®­ç»ƒä¼šä¸€ç›´æé«˜

å½“å…¶è¾¾åˆ°æ•ˆæœæœ€å¥½çš„åœ°æ–¹ï¼Œä½†æ­¤æ—¶Q0å€¼å’Œå®é™…çš„å¥–åŠ±åå·®è®©actorç½‘ç»œç»§ç»­æ›´æ–°ï¼Œæ‰€ä»¥kå€¼ç»§ç»­å¢åŠ ï¼Œæœ€ç»ˆå¯¼è‡´å¤±ç¨³

actorç½‘ç»œæ›´æ–°æ—¶æŸå¤±å‡½æ•°çš„æ¢¯åº¦è®¡ç®—
$$
\nabla J(\theta)=\frac{1}{N}\sum_{i=1}^{N}\sum_{t=1}^{T}\nabla_\theta log\pi_\theta(a_{i,t}|s_{i,t})(r(s_t,a_t)+\hat{V}(s_{t+1})-\hat{V}(s_t))
$$
ç­–ç•¥æ›´æ–°
$$
\theta=\theta+\alpha \nabla J(\theta)
$$
å…¶ä¸­$\pi_\theta$ä¸ºactorè¾“å‡ºå€¼

å¯¹$\nabla_\theta log \pi_\theta$æ±‚æ¢¯åº¦ï¼š
$$
\nabla_\theta log \pi_\theta=\frac{1}{\pi_\theta}\nabla\pi_\theta
$$
å¯¹actorç¥ç»ç½‘ç»œåå‘ä¼ æ’­ï¼Œç”±äºactorçš„é¢„æµ‹predictå‡½æ•°ä¸ºå‚æ•°çš„ç»å¯¹å€¼ä¹˜ä¸Šè¾“å…¥ï¼Œ$\nabla\pi_\theta$ä¸$\pi_\theta$åŒå·ï¼Œwä¸ºè´Ÿï¼Œæ‰€ä»¥å‰é¢è¿™ä¸€æ•´ä½“æ’ä¸ºè´Ÿæ•°

è€Œ$r(s_t,a_t)$æ˜¯ä»ç¯å¢ƒä¸­å¾—åˆ°çš„å¥–åŠ±ï¼Œæ ¹æ®TD3ç®—æ³•å¯¹åº”çš„å¥–åŠ±ç¯å¢ƒï¼Œå¾—åˆ°çš„å¥–åŠ±éƒ½æ˜¯è´Ÿçš„ï¼Œæ‰€ä»¥$r(s_t,a_t)$ä¸€å®šä¸ºè´Ÿï¼Œè‡³äºè¯´$\hat{V}(s_{t+1})-\hat{V}(s_t)$ï¼Œæ ¹æ®å­¦ä¹ æ›²çº¿å¯çŸ¥ï¼ŒQ0ä¸€ç›´éƒ½æ˜¯0é™„è¿‘ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¿½ç•¥ï¼Œå› æ­¤åé¢è¿™ä¸€æ•´ä½“ä¸ºè´Ÿæ•°

ç»¼ä¸Šæ‰€è¿°ï¼Œwä¸ºè´Ÿæ—¶ï¼Œ$\nabla J(\theta)$ä¸€å®šæ˜¯æ­£çš„ï¼Œè€Œå½“wä¸ºæ­£æ—¶ï¼Œ$\nabla J(\theta)$åˆæ’ä¸ºè´Ÿçš„ï¼Œ$\alpha$æ˜¯ç¥ç»ç½‘ç»œå­¦ä¹ ç‡ï¼Œæ’æ­£ä¸”ä¸å˜ï¼Œæ‰€ä»¥è¯´$\theta$åœ¨ä¸€ç›´å˜å°ï¼Œå†çœ‹çœ‹è®­ç»ƒä¸­é—´è¿‡ç¨‹çš„å®é™…è®¾å®šçš„ç¥ç»ç½‘ç»œå¯å­¦ä¹ å‚æ•°ï¼Œæ‰€ä»¥ä»–åº”è¯¥åœ¨w=0å‡ºç¨³å®šã€‚ï¼ˆæ¨å¯¼å¤±è´¥ğŸ˜‚ï¼‰

> é€šè¿‡ä»£ç åˆ¤æ–­wå€¼æ­£è´Ÿï¼š
>
> <img src="https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230309140424608-16784565146954.png" alt="image-20230309140424608" style="zoom:50%;" />

## 3.10çœ‹æ–‡æ¡£

### å‘ç°

ç¿»äº†ç¿»matlabå¼ºåŒ–å­¦ä¹ æ–‡æ¡£ï¼Œçœ‹åˆ°ä¸ªæ§åˆ¶æ°¸ç£åŒæ­¥ç”µæœºçš„matlabèŒƒä¾‹ï¼Œç”µæœºåˆ†å¤–ç¯è½¬é€Ÿpiæ§åˆ¶å™¨ï¼Œå†…ç¯ç”µæµpiæ§åˆ¶å™¨ï¼Œä»–æ˜¯ç”¨å¼ºåŒ–å­¦ä¹ æ›¿ä»£äº†å†…ç¯æ§åˆ¶ï¼Œé‡‡æ ·æ—¶é—´æ˜¯2e-4ï¼Œæˆ‘ç”¨çš„æ‰1e-2ï¼Œæ„Ÿè§‰å­¦ä¸ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šè·Ÿè¿™ä¸ªæœ‰å…³ã€‚

ç„¶åå°±æ˜¯è¿™ä¸ªèŒƒä¾‹çš„å¥–åŠ±å‡½æ•°è®¾è®¡çš„ä¹ŸæŒºå¥½çš„æ„Ÿè§‰


$$
r_{t}=-\left(Q_{1} * \mathrm{id}_{\text {error }}^{2}+Q_{2} * \mathrm{iq}_{\text {error }}^{2}+R * \sum_{j} u_{t-1}^{j}{ }^{2}\right)-100 d
$$


å…¶ä¸­$Q_1 = Q_2 = 5 ï¼Œ R =0.1$

![image-20230311190618068](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230311190618068.png)å®˜æ–¹è®­ç»ƒç»“æœ

å¯¹æ¯”è®¾ç½®é‡‡æ ·æ—¶é—´ä¸º1e-2çš„ç»“æœ

![image-20230311191143968](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230311191143968.png)

é‡‡æ ·æ—¶é—´ä¸º1e-3

![image-20230311193836922](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230311193836922.png)

é‡‡æ ·æ—¶é—´ä¸º1e-4

![image-20230311202851547](https://cdn.jsdelivr.net/gh/So1omonintrouble/gitpush/image/image-20230311202851547.png)
